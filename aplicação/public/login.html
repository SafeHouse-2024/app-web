<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <link rel="stylesheet" href="./css/cadastro.css" />
  </head>
  <body>
    <div class="bgAnimado" id="bgAnimado">
      <div class="bgAdmin" id="bgAdmin"></div>
    </div>
    <main>
      <h1>Faça seu login</h1>
      <form onsubmit="return false">
        <span>
          <label for="email">E-mail</label>
          <input type="text" id="ipt_email" name="email" required />
        </span>
        <span>
          <label for="senha">Senha</label>
          <input type="password" id="ipt_senha" name="senha" required />
        </span>
        <button onclick="login()">Login</button>
      </form>
      <a href="./cadastro.html">Faça seu cadastro!</a>
    </main>
  </body>
</html>
<script>
  const bgAnimado = document.getElementById("bgAnimado");

  const numerosDeCaixas = 400;

  for (let i = 0; i < numerosDeCaixas; i++) {
    const caixa = document.createElement("div");
    caixa.classList.add("caixaColorida");
    bgAnimado.appendChild(caixa);
  }

  function login() {
    var email = document.getElementById("ipt_email").value;
    var senha = document.getElementById("ipt_senha").value;

    if (email != "" || senha != "") {
      fetch("/usuario/autenticar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          emailServer: email,
          senhaServer: senha,
        }),
      })
        .then(function (resposta) {
          if (resposta.ok){
            console.log(`#SUCESSO: ${resposta}`);
            window.location.href = "/dashboard.html";
          }else if(resposta.status == 401){
            console.log(`#ERRO: ${resposta}`);
            alert("Usuário ou senha inválidos");
          }

        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });
    }
  }
</script>
